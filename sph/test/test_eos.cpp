
/*! @file
 * @brief EOS unit tests
 *
 * @author Osman Seckin Simsek <osman.simsek@unibas.ch>
 */

#include <cmath>
#include <cstdio>
#include <random>

#include "gtest/gtest.h"
#include "sph/helmholtz_eos.hpp"
#include "sph/eos.hpp"

using namespace sph;

TEST(EOSTests, helmholtzEOS_test)
{
    int input_size = 100;
    int test_size  = 10;

    std::vector<double> rho_in{
        4.0129748543692845e+03, 8.0731438304669466e+06, 4.7530262554032750e-09, 1.0337977079212051e+10,
        1.2557964368024208e+06, 5.0724238501419932e+07, 1.7717369378621492e-08, 4.8063507641893854e-01,
        3.1193161271643227e-05, 2.4100913505996707e+11, 3.6077534362877028e+04, 9.0542973671811622e-05,
        2.3959904624854968e-08, 4.0455901276936449e+04, 5.5786765053673230e-10, 6.0968806966071450e+14,
        7.8174415058971221e+01, 1.0132003347658399e-10, 4.3030181973933378e-07, 8.0346410269226760e-05,
        4.5693071821029863e+09, 2.1998560691894122e+03, 1.0535458925317339e-07, 2.9624942551279523e+13,
        2.3632170343389691e-07, 1.2347521259116894e+06, 1.1369281944837711e+10, 8.0870878698438034e+09,
        3.9527054263599631e+14, 1.1794515735465646e+02, 3.3695142693116450e-11, 6.2171064790687160e+04,
        1.4141386887644189e-01, 3.4716976578732142e-12, 1.9072829935343297e-09, 1.1865519756398864e-10,
        3.4876920427623516e-10, 1.5123364410496270e+01, 3.1758941692274507e+07, 3.1349667709716295e-11,
        1.4697025853255183e+04, 4.0126215291904708e+04, 1.5810568169418869e+09, 3.0076714934722688e+07,
        1.2011947786513963e+04, 3.7829236443682988e-03, 4.7022782760426184e-09, 1.3195135161323696e+01,
        9.2298370797226218e-09, 2.6685427446078384e-12, 2.4770908975957934e-08, 8.0193911698717546e-01,
        3.3922005570894854e+01, 4.4403671417676266e-01, 5.2790971819844676e+00, 1.4280422692143559e-04,
        4.6590141902132109e-01, 4.8903132070606118e+06, 1.4878134248017738e-08, 1.5982340600458732e-07,
        1.0917521720484560e+09, 2.6559616619287028e-04, 4.2048471716455762e-07, 1.9189336726466125e-01,
        1.6454926299993234e+05, 1.1093974252168459e+05, 4.7197394764862925e-05, 5.3853054408373400e-11,
        3.3283344245081253e-09, 1.6044624614211783e+07, 5.2093375235578718e+09, 9.8784933945641005e-08,
        1.1287852283576921e-01, 6.9053187033422072e-11, 1.4128230366115675e-07, 1.6594572796147213e+02,
        4.5616517200912172e+08, 9.0274438939889193e-02, 1.7573896587133810e-03, 1.1505509276464714e+10,
        2.9950659967309230e+13, 3.1009561497291368e-09, 7.7850101374635864e+06, 3.8370851605724548e-11,
        1.1669169316316699e-06, 1.1428754668358753e-03, 2.1349064333842895e+06, 8.8294441871091019e+10,
        1.5605451727553346e-08, 4.7403150212892916e+02, 9.3868430181297070e+12, 6.6186678345672021e+11,
        5.6628259816351649e+05, 4.7354939269419070e+13, 9.5334655905557785e+10, 1.1293786475148750e+13,
        1.4388019854348313e+03, 6.0633480874380589e+09, 1.1869763419999341e-02, 8.7807255094895560e-06};
    std::vector<double> temp_in{
        3.8963716099786788e+08, 7.1081635134665784e+05, 3.8972964217650144e+04, 6.4771812156829570e+12,
        2.6251281944905692e+06, 7.3171820996045171e+03, 2.9722636454104171e+06, 8.8357715238764763e+09,
        2.1458800070626166e+05, 7.3504924600129216e+03, 5.0311636371525839e+07, 5.1018445717654839e+09,
        3.6077321604725454e+12, 1.8308645901663837e+06, 1.0165114299320687e+04, 3.1510920808987107e+07,
        1.8748837190885442e+03, 2.0057610951576181e+07, 1.6049521875074775e+12, 7.6933037289234160e+12,
        5.9061162610469265e+09, 2.2793961312538556e+11, 1.5354638742278977e+06, 2.8004318113046616e+12,
        5.4626785321737971e+03, 7.1505622743794556e+11, 3.7817276201026609e+04, 1.1216808528548968e+06,
        3.6161203019436539e+03, 3.6698247121838533e+05, 2.8071643178031387e+04, 2.3147058668349497e+05,
        6.4930316897124922e+12, 6.6076646009307694e+08, 1.4113937785341284e+08, 2.4746500691428399e+06,
        3.8600147467584570e+03, 2.3968011572010513e+04, 9.6705094842292080e+09, 4.6066877641900683e+03,
        5.0133726925448789e+12, 1.3824448435079385e+07, 3.4328362976051384e+08, 3.5147774792068033e+05,
        7.4714577839467314e+05, 5.0667997664221747e+11, 5.7300638239447044e+03, 3.0280669705169189e+08,
        1.5752243996536055e+04, 5.0538683809522383e+07, 1.6779338840689939e+04, 3.3880150133944995e+12,
        3.3024825576670016e+06, 1.9004971530588306e+05, 3.6281387104723076e+10, 4.2962428577947931e+05,
        1.2827545626385004e+03, 2.8909767623578018e+05, 2.3591806863330211e+07, 2.5910381342961128e+10,
        6.6407138102750391e+12, 2.5952440738521423e+09, 1.6030194813233481e+11, 4.6286123666247091e+09,
        4.1615853638452113e+08, 1.6311623120065415e+03, 4.6985028782304646e+04, 1.5514190657510527e+05,
        6.2517295023834392e+07, 4.0059662755737435e+06, 5.7257690843587324e+07, 6.1878185532707715e+12,
        5.6718816827483868e+04, 1.0939498656081245e+10, 1.3517539285874877e+07, 8.8460647490543104e+05,
        8.5188974602761841e+05, 2.7409337934233890e+09, 1.2355192982453181e+05, 4.2806415944781656e+04,
        2.1696091256011494e+10, 7.1884922390004675e+11, 3.9018315175607488e+04, 1.6136040188111760e+03,
        8.6676364224137878e+09, 1.4000201724310973e+05, 6.8025109023399756e+12, 3.8842221683507545e+04,
        1.1075502610236065e+03, 9.7989170517297328e+07, 2.8440228467274490e+06, 1.8788115692544941e+05,
        8.5844726472106649e+03, 1.3210951223118631e+10, 1.5905431473240552e+09, 1.0819716571781293e+06,
        6.0956850553046450e+07, 7.4437405411744849e+03, 5.6094959171526189e+03, 1.6382671014185535e+03};

    std::vector<double> p_sol{
        3.1935322852715908e+20, 1.6771448101256210e+24, 3.6617369061730336e+04, 1.2206987940748362e+37,
        1.0841716811641624e+23, 2.1830742171961943e+25, 1.9683411385795737e+11, 3.9952356145524649e+25,
        1.1175236947257891e+09, 1.8560847112384438e+30, 5.6569386996063699e+20, 4.0400348741879195e+24,
        1.1744647845008998e+36, 4.5905948168832739e+20, 9.6959508196685249e+02, 6.3997794839224604e+34,
        1.2469647832347000e+16, 4.0817701267653506e+14, 4.5992668902793173e+34, 2.4275225177055959e+37,
        1.1851289597151500e+28, 1.8719891102440470e+31, 1.4045032150870640e+10, 4.3354278044679905e+35,
        2.1133945979533636e+05, 1.8130983824960942e+33, 3.1584123345619698e+28, 2.0046353874530261e+28,
        3.5907777437599244e+34, 2.9766463111164268e+16, 1.7233273469399817e+03, 9.1595217497216922e+20,
        1.2326917909840093e+37, 4.8306741282894945e+20, 1.0007475244133925e+18, 9.4577348977013428e+10,
        2.2417447095605516e+02, 7.6080082799035425e+14, 9.2775693194728685e+25, 2.5144539828570743e+01,
        4.3811092144848658e+36, 4.9809096195416234e+20, 2.3135856033497468e+27, 1.0631139284735837e+25,
        6.1464945439119819e+19, 4.5707904669877670e+32, 4.4731963196215165e+03, 2.1867251236570604e+19,
        2.4314945556056988e+04, 1.6452331014282286e+16, 6.9243529095862308e+04, 9.1378813692387029e+35,
        1.9536172819228640e+16, 1.3661473119423650e+13, 1.1973316083183101e+28, 1.0281814725210236e+10,
        2.8602670289995322e+12, 8.1473455528913982e+23, 7.8122580218474475e+14, 3.1051326026234938e+27,
        1.3487262234570480e+37, 2.0447094734310837e+23, 4.5789009717178457e+30, 2.6639142412608244e+24,
        1.3295305917494840e+22, 2.3502906795724906e+21, 3.6546199221844774e+08, 1.4623826315954223e+06,
        3.8524095017928800e+16, 4.4381675901531430e+24, 1.1173849581425698e+28, 1.0174811441066025e+37,
        9.3506850715022656e+11, 9.5743439291281418e+25, 8.4202295112557250e+13, 6.0813972731371952e+16,
        4.2788296064130902e+26, 2.6238184131046856e+23, 3.5666507732827095e+10, 3.2090220400251993e+28,
        1.2093388106680144e+33, 1.8505681200276487e+33, 1.5915535672297609e+24, 1.0298749391251606e+01,
        3.6891689044840816e+25, 2.6384211609359035e+10, 1.4850516706378897e+37, 4.8643722754552831e+29,
        2.7591891623415800e+03, 7.9937374493511311e+18, 2.4510797119663779e+32, 7.1389920860823646e+30,
        3.1649836588632476e+22, 2.1775603138557551e+33, 5.5264453275324613e+29, 3.1365030462320412e+32,
        1.5070558493759152e+19, 1.3646050425820680e+28, 1.4317313853881956e+10, 1.5964228712912786e+06};

    std::vector<double> cv_sol{
        7.1336786311684918e+08, 2.3212881550888583e+08, 6.2637493997398615e+08, 2.1876019967527335e+15,
        1.7223790093982586e+08, 6.8045524205361724e+08, 4.4851620763202859e+13, 1.1816643785346822e+17,
        2.5922288736949819e+08, 1.3186643377692115e+09, 1.8667147640542361e+08, 1.1796902791470023e+20,
        1.6436312240546602e+32, 1.5806297127989379e+08, 3.0649579778398263e+08, 3.5795274237263757e+08,
        3.4611699368926656e+08, 2.4102120908591908e+18, 8.0405805155206495e+29, 4.7114548067468684e+29,
        1.7447378324790046e+08, 4.4802690764196122e+17, 1.0401177849386906e+12, 6.1814300883919571e+10,
        2.5252185251178089e+08, 2.4642560132510072e+16, 7.0613015858199310e+08, 3.2934146803802693e+08,
        2.7419165653579721e+09, 1.7080845954595444e+08, 2.0117213016976757e+10, 2.1328923097318390e+08,
        1.6110026927712478e+26, 2.6312587091842330e+24, 4.4611048987367039e+19, 3.8651613124333890e+15,
        2.5468565383879232e+08, 2.0172340023673373e+08, 2.3127954763486309e+09, 3.4387091583289158e+08,
        7.1352011286157027e+20, 1.4906822772140956e+08, 1.3867122733143386e+08, 2.8656520327704030e+08,
        1.6731006366030619e+08, 2.8616597922199413e+24, 2.5115211911385474e+08, 6.3943085717909111e+10,
        2.6241758653595927e+08, 1.4638972461285675e+21, 2.5544981907131302e+08, 4.0358987407478067e+24,
        2.4482136715754369e+08, 2.5356639311854517e+08, 7.5243664577179981e+17, 2.6640729001577580e+08,
        1.2761890675073358e+08, 2.6508092565408596e+08, 2.6708415203103228e+16, 9.0524790629052396e+24,
        2.2323687680959268e+16, 4.7308510157252700e+18, 8.2083287363695327e+26, 4.1237646349789736e+16,
        2.5933735344824871e+08, 6.0172714289702308e+08, 2.5137253920846975e+08, 2.0986578041416794e+12,
        2.2217058334615910e+18, 1.8256769645419410e+08, 1.6551700069032663e+08, 1.9935443803281820e+32,
        2.5785981825198272e+08, 1.5606367743359280e+27, 5.2907633275018962e+14, 1.7863481435448360e+08,
        2.8773215726147920e+08, 1.6662653603066632e+16, 2.5196786509331891e+08, 6.8696370801064610e+08,
        1.3838268808560133e+08, 9.9941957090743177e+30, 4.0894895994996804e+08, 2.5306446677052698e+08,
        4.5608063214432996e+22, 2.5128958853810760e+08, 1.2270848853712835e+19, 8.2189751088250315e+08,
        2.5622515721546546e+08, 3.1392769141567659e+08, 4.4352453164118481e+08, 6.6708786640821278e+08,
        4.6946810031352335e+08, 1.3794812130765641e+08, 1.3808540336007482e+08, 5.5607582722005928e+08,
        2.5354429929144245e+08, 9.8187322617539811e+08, 2.1899524193959892e+08, 2.7381723994390029e+08};

    std::vector<double> u_sol{
        1.4487787712240211e+17, 4.0796081969339603e+17, 1.3390884627221234e+13, 3.5423741771884556e+27,
        1.4775071524063315e+17, 9.7431503006226995e+17, 3.3328266611775775e+19, 2.5808564555926712e+26,
        5.3953197567296102e+13, 2.2622638645125665e+19, 2.3811873628943704e+16, 1.4539895885185841e+29,
        1.4705865659921118e+44, 1.7128854974283912e+16, 2.6785891865111855e+12, 3.1440815465670128e+20,
        2.0334347369751344e+14, 1.2085774111067227e+25, 3.2070243524043884e+41, 9.0714385251687951e+41,
        6.5945823094670387e+18, 2.5530371817914606e+28, 3.9955309751537958e+17, 4.3553430540401009e+22,
        1.3202747187593845e+12, 4.4051971100423869e+27, 7.8734160782791014e+18, 6.9794878042478070e+18,
        2.7203859145502553e+20, 3.4599232262845744e+14, 1.4643203810592581e+14, 2.2377823176421564e+16,
        2.6150728338676020e+38, 4.2253028015178942e+32, 1.5740939248929388e+27, 2.3912308902923893e+21,
        9.6545699600855054e+11, 5.5834175162840727e+13, 7.2595689735502152e+18, 1.2571367101079766e+12,
        8.9428553353941356e+32, 1.8813635815613292e+16, 3.9158049878286336e+18, 7.7016087841884826e+17,
        7.5796030517899150e+15, 3.6248528563864816e+35, 1.4245753781678613e+12, 4.8984213426372270e+18,
        3.9740143533695059e+12, 1.8495860012940046e+28, 4.2007363159363545e+12, 3.4184211404033919e+36,
        8.5376176459825500e+14, 4.2130037922422844e+13, 6.8205962500694004e+27, 1.0883939416401258e+14,
        9.2089152582808047e+12, 3.1435075532045082e+17, 1.5752494769506605e+23, 5.8530498986072519e+34,
        3.7061305209960315e+28, 2.7544828816904832e+27, 3.2654441344242602e+37, 4.5788760136196748e+25,
        1.2839272467201358e+17, 3.2602883514320796e+16, 1.1509586589606084e+13, 8.1426466663939184e+16,
        3.4723759773419601e+25, 5.7391103310137018e+17, 5.9765829126753321e+18, 3.0876331653554589e+44,
        9.4255236335022441e+12, 4.2539920887047235e+36, 1.7879550594954591e+21, 5.1790258263948562e+14,
        2.4125340048775557e+18, 1.0327794907172049e+25, 3.0054067663032750e+13, 7.9065740255357962e+18,
        1.1793655054815609e+20, 1.7913640448219383e+42, 4.0028912231725536e+17, 4.0271301089664001e+11,
        9.8346855884584033e+31, 3.4328280036863418e+13, 2.0868145412555615e+31, 1.6051172448196919e+19,
        2.5416575327289127e+11, 2.6274658758544592e+16, 7.7845676320041468e+19, 3.1873785290413048e+19,
        9.1411255832737040e+16, 1.3581277192132274e+20, 1.6715277977152645e+19, 8.2825899091387466e+19,
        1.5836530365652326e+16, 6.2985325362683238e+18, 1.8093024288137148e+12, 1.3619371094122137e+11};

    std::vector<double> p(input_size), c(input_size), cv(input_size), u(input_size);

    helmholtz_constants::Helmholtz_EOS* helmEOS = new helmholtz_constants::Helmholtz_EOS();

    for (int i = 0; i < test_size; ++i)
    {
        std::tie(c[i], p[i], cv[i], u[i]) = helmholtzEOS<double, double>(helmEOS, temp_in[i], rho_in[i], 1.0, 1.0);
    }

    for (int i = 0; i < test_size; ++i)
    {
        EXPECT_NEAR(p[i] / p_sol[i], 1.0, 1.0e-6);
        EXPECT_NEAR(cv[i] / cv_sol[i], 1.0, 1.0e-6);
        EXPECT_NEAR(u[i] / u_sol[i], 1.0, 1.0e-6);

        // EXPECT_NEAR(p[i], p_sol[i], 1.0e-6);
        // EXPECT_NEAR(cv[i], cv_sol[i], 1.0e-6);
        // EXPECT_NEAR(u[i], u_sol[i], 1.0e-6);
    }
    delete helmEOS;
}