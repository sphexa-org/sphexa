include:
  - local: 'ci/common.yml'

sph-build-cuda12-sm90-debug:
  stage: sphexa_build
  # needs: ['sph:base:cuda12']
  image: prgenv-gnu/24.11:v1
  extends: [.uenv-runner-daint-gh200]
  variables:
    PERSIST_IMAGE_NAME: ${CSCS_REGISTRY_PATH}/sphexa_cuda12_debug:${CI_COMMIT_SHORT_SHA}
    WITH_UENV_VIEW: 'default'
    SLURM_PARTITION: 'debug'
    SLURM_JOB_NUM_NODES: 1
    SPH_INSTALLDIR: ${SPH_INSTALLDIR_DAINT}/${CI_COMMIT_SHORT_SHA}
    # SLURM_NTASKS: 1
    # JG: 'YES'
    # PERSIST_IMAGE_NAME: "${BUILD_CUDA12_SM90_DEBUG}"
  before_script:
    - pwd
    - cmake --version
    - mpicxx --version
    - nvcc --version
    - echo "OUT / PERSIST_IMAGE_NAME = ${PERSIST_IMAGE_NAME}"
    - echo "SPH_INSTALLDIR_DAINT/CI_COMMIT_SHORT_SHA = ${SPH_INSTALLDIR_DAINT}/$CI_COMMIT_SHORT_SHA"
    - echo "SPH_INSTALLDIR = ${SPH_INSTALLDIR}"
    # do not use : !
  script:
    # jfrog.svc.cscs.ch/docker-ci-ext/44692846847247/sphexa_cuda12_debug:b75f47f5
    # /capstor/scratch/cscs/piccinal/gitlab-runner/builds/hY7owqPdK/0/4264416954089684
    - mkdir -p ${SPH_INSTALLDIR}
    - touch ${SPH_INSTALLDIR}/xx
#     - CC=mpicc CXX=mpicxx cmake -S . -B build
#       -DCMAKE_CUDA_ARCHITECTURES=90
#       -DCMAKE_BUILD_TYPE=Debug
#     - cmake --build build -j `grep -c processor /proc/cpuinfo |awk '{print $0/3}'`
#     - mkdir -p ${SPH_INSTALLDIR}
#     - cmake --install build --prefix=${SPH_INSTALLDIR}
