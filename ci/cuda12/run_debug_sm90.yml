include:
  - local: 'ci/common.yml'

# sph-run_unittests_cuda12-sm90-debug-cpu-1rank:
sph-run-cuda12-sm90-debug-1:
  stage: sphexa_run
  needs: ['sph-build-cuda12-sm90-debug']
  image: prgenv-gnu/24.11:v1
  extends: [.uenv-runner-daint-gh200]
  variables:
    WITH_UENV_VIEW: 'default'
    SLURM_PARTITION: 'debug'
    SLURM_JOB_NUM_NODES: 1
    SLURM_NTASKS: 1
  before_script:
    - pwd
    # - echo "CI_COMMIT_SHORT_SHA = ${CI_COMMIT_SHORT_SHA}"
    - export SPH_INSTALLDIR=${SCRATCH}/ci/daint/${CI_COMMIT_SHORT_SHA}
    - echo "Debug with cd ${SPH_INSTALLDIR}; uenv start --view=${WITH_UENV_VIEW} ${UENV_MOUNT_LIST}"
    #
  script:
    - $SPH_INSTALLDIR/sbin/coord_samples/coordinate_test
    - $SPH_INSTALLDIR/sbin/hydro/turbulence_tests
    - ln -s sbin/hydro/example_data.txt .
    - $SPH_INSTALLDIR/sbin/hydro/sph_tests
    - $SPH_INSTALLDIR/sbin/performance/octree_perf
    - $SPH_INSTALLDIR/sbin/performance/peers_perf
    - $SPH_INSTALLDIR/sbin/performance/scan_perf
    - $SPH_INSTALLDIR/sbin/ryoanji/cpu_unit_tests/ryoanji_cpu_unit_tests
    - $SPH_INSTALLDIR/sbin/ryoanji/unit_tests/ryoanji_unit_tests
    - $SPH_INSTALLDIR/sbin/unit/component_units_omp
    - $SPH_INSTALLDIR/sbin/unit/component_units

