# Add a pipeline to compute radius. Origin: 0, 0, 0
-
  action: "add_pipelines"
  pipelines:
    pl1:
      f1:
        type: "threshold"
        params:
          field: Z
          # min_value: "-0.0005"
          # max_value: "0.0005"
          min_value: "-0.05"
          max_value: "0.05"
      f2:
        type: "composite_vector"
        params:
          field1: VX
          field2: VY
          field3: VZ
          output_name: "VectorVel"
      f3:
        type: "vector_magnitude"
        params:
          field: "VectorVel"
          output_name: "ModularVel"
    pl2:
      f4:
        type: "threshold"
        params:
          field: Z
          min_value: "-0.0005"
          max_value: "0.0005"
          # min_value: "-0.05"
          # max_value: "0.05"
      # f5:
      #   type: "expression"
      #   params:
      #     expression: "field('CurlV')*field('CurlV')"
      #     name: "CurlVSquare"
      # f6: 
      #   type: "log"
      #   params: 
      #     field: "CurlVSquare"
      #     output_name: "LogCurlVSquare"
      # f7:
      #   type: "threshold"
      #   params:
      #     field: Z
      #     min_value: "-0.05"
      #     max_value: "0.05"

- 
  action: add_scenes
  scenes: 
    s1: 
      plots: 
        p1: 
          field: ModularVel
          type: pseudocolor
          pipeline: pl1
          color_table:
            name: Viridis
            annotation: "false"
          points:
            radius: .001
      renders:
        r1:
          world_annotations: "false"
          camera:
            look_at: [0, 0, 0]
            position: [0, 0, 1]
          dataset_bounds: [-0.5, 0.5, -0.5, 0.5, -0.5, 0.5]
          image_prefix: turbulence_ModularV_step%05d
    s2: 
      plots: 
        p1: 
          field: CurlV
          type: pseudocolor
          pipeline: pl2
          color_table:
            name: Viridis
          points:
            radius: .001
      renders:
        r1:
          world_annotations: "false"
          camera:
            look_at: [0, 0, 0]
            position: [0, 0, 1]
          dataset_bounds: [-0.5, 0.5, -0.5, 0.5, -0.5, 0.5]
          image_prefix: turbulence_LogCurlV_step%05d

- 
  action: "add_extracts"
  extracts: 
    e1: 
      type: "relay"
      pipeline: "pl1"
      params: 
        protocol: json
        path: "curlv.json"
        fields:
         - X
         - Y
         - Z
         - ModularVel
         - CurlV

- 
  action: "execute"